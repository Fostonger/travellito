---
name: quality-gates-tests
description: Quality gates для этого репозитория. Используй при ЛЮБЫХ изменениях кода (FastAPI/aiogram/SQLAlchemy/Alembic/Minio). Перед финальным ответом ОБЯЗАТЕЛЬНО запускать проверки строго по инструкции.
---

# Quality Gates (обязательно перед финальным ответом)

## Правило: проверки обязательны

Если ты меняешь код, конфиги, миграции или зависимости — ты ОБЯЗАН выполнить соответствующие проверки.
Не сообщай, что "всё готово", пока проверки не пройдены.

---

## Python Backend (web/)

### 1. Проверка импортов
```bash
cd web && ../.venv/bin/python -c "from app.main import app; print('OK')"
```

### 2. Тесты (если существуют)
```bash
cd web && ../.venv/bin/pytest -v
```

> **Примечание**: Тесты пока находятся в разработке. Если директория `web/tests/` отсутствует — пропусти этот шаг, но сообщи об этом.

### 3. Проверка типов (опционально, если настроен mypy)
```bash
cd web && ../.venv/bin/mypy app/ --ignore-missing-imports
```

---

## Telegram Bot (bot/)

### 1. Проверка импортов
```bash
cd bot && ../.venv/bin/python -c "from app.main import app; print('OK')"
```

### 2. Проверка support bot
```bash
cd bot && ../.venv/bin/python -c "from app.support_bot import app; print('OK')"
```

---

## WebApp React (bot/webapp/)

### 1. TypeScript проверка
```bash
cd bot/webapp && npx tsc --noEmit
```

### 2. Сборка
```bash
cd bot/webapp && npm run build
```

> **Важно**: Если `tsc` показывает ошибки — исправь их. `@ts-nocheck` допустим только для legacy-файлов, не добавляй его в новый код.

---

## Миграции Alembic

Если изменены модели в `web/app/models.py`:

```bash
cd web && ../.venv/bin/alembic revision --autogenerate -m "описание изменений"
cd web && ../.venv/bin/alembic upgrade head
```

---

## Что делать при ошибках

1. **Не игнорировать** — любая ошибка требует внимания
2. **Диагностика** — опиши: какая ошибка, где, почему
3. **Исправление** — исправь или минимизируй изменения до прохода проверок
4. **Флейки** — если падение не связано с изменениями (инфра, флейк) — явно отметь это

---

## Чеклист перед сдачей

- [ ] Код импортируется без ошибок (Python)
- [ ] TypeScript компилируется без ошибок (WebApp)
- [ ] Тесты запущены и прошли (если существуют)
- [ ] Миграции созданы для изменений моделей
- [ ] Нет закомментированного кода или TODO без объяснения
