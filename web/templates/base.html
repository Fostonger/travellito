<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>{% block title %}Travellito Админ{% endblock %}</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>            <!-- Tailwind CDN -->
  <script src="https://unpkg.com/flowbite@2.3.0/dist/flowbite.js"></script>
  <!-- Authentication handling -->
  <script src="/static/auth.js"></script>
</head>
<body class="bg-gradient-to-r from-indigo-50 to-teal-50 min-h-screen">
  <!-- Admin Navbar -->
  <nav class="bg-white/90 shadow-md backdrop-blur sticky top-0 z-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex">
          <a href="/admin" class="flex-shrink-0 flex items-center text-indigo-700 font-bold">Travellito Админ</a>
          <div class="hidden sm:-my-px sm:ml-6 sm:flex sm:space-x-8">
            <a href="/admin/tours" class="inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium text-gray-700 hover:border-indigo-500">Экскурсии</a>
            <a href="/admin/agencies" class="inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium text-gray-700 hover:border-indigo-500">Агентства</a>
            <a href="/admin/landlords" class="inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium text-gray-700 hover:border-indigo-500">Арендодатели</a>
            <a href="/admin/support" class="inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium text-gray-700 hover:border-indigo-500">
              Поддержка
              <span id="supportCounter" class="ml-1 px-1.5 py-0.5 bg-red-500 text-white text-xs rounded-full hidden">0</span>
            </a>
            <a href="/admin/settings" class="inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium text-gray-700 hover:border-indigo-500">Настройки</a>
          </div>
        </div>
      </div>
    </div>
  </nav>

  {% block body %}{% endblock %}

  <!-- Bootstrap JS bundle (Modal etc.) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Check for pending support messages and update counter
    async function updateSupportCounter() {
      try {
        const response = await fetch('/api/v1/support/messages?status=pending', {
          credentials: 'same-origin'
        });
        
        if (response.ok) {
          const messages = await response.json();
          const counter = document.getElementById('supportCounter');
          
          if (messages.length > 0) {
            counter.textContent = messages.length;
            counter.classList.remove('hidden');
          } else {
            counter.classList.add('hidden');
          }
        }
      } catch (error) {
        console.error('Error checking support messages:', error);
      }
    }
    
    // Run on page load and every 60 seconds
    document.addEventListener('DOMContentLoaded', updateSupportCounter);
    setInterval(updateSupportCounter, 60000);
  </script>
</body>
</html>
