{% extends "base.html" %}
{% block title %}Upload Tour{% endblock %}
{% block body %}
<div class="max-w-2xl mx-auto my-12 p-8 bg-white/90 rounded-2xl shadow-xl backdrop-blur">
  <h1 class="text-3xl font-extrabold mb-6 text-indigo-700">New Tour</h1>
  <form id="tourForm" class="space-y-6" enctype="multipart/form-data" method="post">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label class="block mb-2 font-medium">Title</label>
        <input name="title" required class="w-full rounded-lg border border-indigo-300 p-2.5 focus:ring-2 focus:ring-indigo-500">
      </div>
      <div>
        <label class="block mb-2 font-medium">Price (€)</label>
        <input name="price" type="number" step="0.01" required
               class="w-full rounded-lg border border-indigo-300 p-2.5 focus:ring-2 focus:ring-indigo-500">
      </div>
      <div class="md:col-span-2">
        <label class="block mb-2 font-medium">Description</label>
        <textarea name="description" rows="4" required
                  class="w-full rounded-lg border border-indigo-300 p-2.5 focus:ring-2 focus:ring-indigo-500"></textarea>
      </div>
      <div class="md:col-span-2">
        <label class="block mb-2 font-medium">Images</label>
        <input name="images" type="file" accept="image/*" multiple
               class="block w-full text-sm text-slate-700
                      file:mr-4 file:py-2 file:px-4
                      file:rounded-full file:border-0
                      file:text-sm file:font-semibold
                      file:bg-indigo-50 file:text-indigo-700
                      hover:file:bg-indigo-100">
      </div>
    </div>
    <button class="w-full py-3 mt-4 rounded-xl bg-indigo-600 text-white font-semibold
                   hover:bg-indigo-700 transition">Upload</button>
  </form>
  <p id="msg" class="text-center mt-4"></p>
</div>
<script>
document.getElementById('tourForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const form = e.target;
  const data = new FormData(form);
  data.append('data', JSON.stringify({
    agency_id: 1,
    title: form.title.value,
    description: form.description.value,
    price: parseFloat(form.price.value)
  }));
  const res = await fetch('/admin/tours', {method: 'POST', body: data});
  const out = await res.json();
  document.getElementById('msg').textContent =
    res.ok ? `✅ Tour #${out.id} created!` : `❌ ${out.detail || 'Error'}`;
  form.reset();
});
</script>
{% endblock %}
